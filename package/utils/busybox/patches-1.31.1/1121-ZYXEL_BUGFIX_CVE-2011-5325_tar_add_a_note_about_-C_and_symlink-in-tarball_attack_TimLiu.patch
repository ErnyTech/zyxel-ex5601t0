From a116552869db5e7793ae10968eb3c962c69b3d8c Mon Sep 17 00:00:00 2001
From: Denys Vlasenko <vda.linux@googlemail.com>
Date: Tue, 4 Jan 2011 08:46:26 +0100
Subject: tar: add a note about -C and symlink-in-tarball attack

Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com>
---
 archival/tar.c | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

Index: busybox-1.31.1/archival/tar.c
===================================================================
--- busybox-1.31.1.orig/archival/tar.c	2019-06-10 18:50:53.000000000 +0800
+++ busybox-1.31.1/archival/tar.c	2021-03-16 16:12:19.613806379 +0800
@@ -115,6 +115,25 @@
 
 //kbuild:lib-$(CONFIG_TAR) += tar.o
 
+/* TODO: security with -C DESTDIR option can be enhanced.
+ * Consider tar file created via:
+ * $ tar cvf bug.tar anything.txt
+ * $ ln -s /tmp symlink
+ * $ tar --append -f bug.tar symlink
+ * $ rm symlink
+ * $ mkdir symlink
+ * $ tar --append -f bug.tar symlink/evil.py
+ *
+ * This will result in an archive which contains:
+ * $ tar --list -f bug.tar
+ * anything.txt
+ * symlink
+ * symlink/evil.py
+ *
+ * Untarring it puts evil.py in '/tmp' even if the -C DESTDIR is given.
+ * This doesn't feel right, and IIRC GNU tar doesn't do that.
+ */
+
 #include <fnmatch.h>
 #include "libbb.h"
 #include "common_bufsiz.h"
