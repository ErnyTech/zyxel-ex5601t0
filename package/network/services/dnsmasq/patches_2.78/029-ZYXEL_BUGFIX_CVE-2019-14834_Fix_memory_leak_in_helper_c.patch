Index: dnsmasq-2.78/src/helper.c
===================================================================
--- dnsmasq-2.78.orig/src/helper.c	2021-01-06 16:29:34.000000000 +0800
+++ dnsmasq-2.78/src/helper.c	2021-01-06 16:43:41.710656279 +0800
@@ -83,6 +83,7 @@
   pid_t pid;
   int i, pipefd[2];
   struct sigaction sigact;
+  unsigned char *alloc_buff = NULL;
 
   /* create the pipe through which the main program sends us commands,
      then fork our process. */
@@ -176,11 +177,16 @@
     struct script_data data;
     char *p, *action_str, *hostname = NULL, *domain = NULL;
     unsigned char *buf = (unsigned char *) daemon->namebuff;
-    unsigned char *end, *extradata, *alloc_buff = NULL;
+    unsigned char *end, *extradata;
     int is6, err = 0;
     int pipeout[2];
 
-    free(alloc_buff);
+    /* Free rarely-allocated memory from previous iteration. */
+    if (alloc_buff)
+    {
+      free(alloc_buff);
+      alloc_buff = NULL;
+    }
 
     /* we read zero bytes when pipe closed: this is our signal to exit */
     if (!read_write(pipefd[0], (unsigned char *) &data, sizeof(data), 1)) {
